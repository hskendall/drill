# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Configuration for the Drill-on-YARN client. Provides information needed to
# launch the Drill Application Master under YARN. A separate file,
# drill-cluster.conf, configures the Drill cluster itself.
#
# This file is in HOCON format, see https://github.com/typesafehub/config/blob/master/HOCON.md
# for more information.
#
# To create your own configuration file, copy only those lines that you want
# to change. All values have reasonable defaults that you can see by starting
# your Drill cluster, then viewing the Configuration page. Or, you can use the
#   $DRILL_HOME/bin/drill-on-yarn.sh describe
# command.

drill.yarn: {

  # Name displayed in the YARN management UI for your Drill cluster.

  app-name: "Drill-on-YARN"

  dfs: {
    # Connection to the distributed file system. Defaults to work with
    # a single-node Drill on the local machine.
    # Omit this if you want to get the configuration either from the
    # Hadoop config (set with config-dir above) or from the
    # $DRILL_HOME/core-site.xml.

    connection: "hdfs://localhost/"

    # The distributed file system (DFS such as HDFS) directory in which to store the Drill
    # archive file. Change this if you launch multiple Drill clusters to give
    # each cluster it's own upload location.

    app-dir: "/users/drill"
  }

  drill-install: {

    # The archive (in .tar.gz format) that contains your Drill software, your custom jar files,
    # and your Drill configuration. This is the path the file on your client machine.
    # The base name is used when uploading the file to DFS.

    client-path: "/etc/drill/drill.tar.gz"

    # Set this if the name of the directory inside your archive file differs from
    # the name of the file. That is, by default, my-drill.tar.gz should contain
    # my-drill as its directory name.

    # dir-name: "drill"

    # Note that there are no parameters for the site directory. You specify the
    # site directory location on client launch; Drill-on-YARN automatically
    # creates an archive of that directory.
  }

  # Application Master settings. You should not have to change these.

  am: {

    # Heap memory for the AM. Change this only if you run a large cluster and
    # encounter memory errors.

    heap: "450M"

    # Amount of memory to allocate for the YARN container. Adjust this only if
    # you adjust the heap amount above.

    memory-mb: 512
  }

  # Settings for the Application Master's internal web server.

  http: {

    # Listen port. Change this if you run multiple Drill clusters as
    # YARN may allocate two or more AMs on the same YARN worker node.

    port: 8048

    # Turn this on to enable HTTPS for the AM web UI.

    ssl-enabled: true

    # Turn this on to enable user authentication. With this on, only
    # the user that launched Drill-on-YARN can access the Drill-on-YARN
    # web UI.
    
    auth-enabled: true
    
    # Set this to some value to protect the management REST calls.
    # When the key is set, each rest call must include the key=value
    # parameter. This is not high security, just a speed-bump to prevent
    # accidental cluster changes.

    rest-key=""
  }

  # Configuration for each Drillbit. Drill requires that all Drillbits use the
  # same configuration.

  drillbit: {

    # The amount of memory to allocate to each Drill-bit. This is the amount of memory requested
    # from YARN for each drill-bit. This must be sufficient for
    # the amount of heap memory allocated in drill-env.sh, and the off-heap memory
    # allocated in drill-override.conf.

    memory-mb: 1024

    # The number of YARN virtual cores to allocate to each drill-bit.

    vcores: 4

    # The number of disk channels (or spindles) that Drill typically uses.
    # This value is supported only only selected YARN distributions.

    disks: 3

    # The amount of heap memory to allocate to Drill. This is the equivalent of the
    # DRILL_HEAP environment variable in drill-env.sh when launching Drill outside
    # of YARN.

    heap: "4G"

    # The maximum amount of direct memory to allocate to Drill. This is the equivalent of the
    # DRILL_MAX_DIRECT_MEMORY environment variable in drill-env.sh when launching Drill outside
    # of YARN.

    max-direct-memory: "8G"

    # Add to the class path. Use for things such as HBase, etc. which must be installed
    # on every node. (Drill automatically adds its own class path as well as the one
    # provided by YARN.)

    classpath: ""
  }

  # The pools of hosts on which to launch Drill. Each pool can be one of several types.
  #
  # Note: This version supports a single pool. The example below has multiple pools
  # only to illustrate the various pool types.

  pools: [
    {
      # Arbitrary name, just used for error and statistics reporting.
      # Defaults to "pool-" pool index, starting at 1.

      name: "pool1"

      # Basic pool: let YARN pick any available node.

      type: "basic"

      # Number of Drill-bits to run. (Drill-on-YARN runs each on a separate host,
      # so this is also the number of hosts that will run Drill.)

      count: 2
    },
    {
      name: "pool2"

      # Labeled pool: Use YARN labels to identify which nodes should run Drill.

      type: "labeled"
      
      # Optional label to apply to the AM request. Restricts the AM to run on
      # only nodes with the label.
      
      am-label-expr: "drill-am"

      # The YARN label expression to use to select Drillbit nodes.

      label-expr: "drill"

      # The number of Drill-bits (hosts) to request.

      count: 2
    }
  ]
}