# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Configuration for the Drill-on-YARN client. Provides information needed to
# launch the Drill Application Master under YARN. A separate file,
# drill-cluster.conf, configures the Drill cluster itself.
#
# This file is in HOCON format, see https://github.com/typesafehub/config/blob/master/HOCON.md for more information.

drill.yarn: {

  # Name displayed in the YARN management UI for your Drill cluster.

  app-name: "Drill-on-YARN"

  # Cluster ID. Must be the same as that set in drill-overrides.conf.

  cluster-id: "drillbits1"

  dfs: {

    # Connection to the distributed file system. Defaults to work with
    # a single-node Drill on the local machine.

    connection: "hdfs://localhost/"

    # The distributed file system (HDFS) directory in which to store the Drill
    # archive file. Note that you must also set this option to the same value
    # in drill-cluster.conf.

    dir: "/users/drill"
  }

  # ZooKeeper connection information. The connect and root parameters must
  # be the same as those in drill-overrides.conf.

  zk: {
    connect: "localhost:2181",
    root: "drill",
  }

  drill-install: {

    # The archive (in .tar.gz format) that contains your Drill software, your custom jar files,
    # and your Drill configuration. This is the path the file on your client machine.
    # The base name is used when uploading the file to DFS.

    client-path: "/etc/drill/drill.tar.gz"

    # Set this if the name of the directory inside your archive file differs from
    # the name of the file. That is, by default, my-drill.tar.gz should contain
    # my-drill as its directory name.

    # dir-name: "drill"
  }

  # Application Master settings. You should not have to change these.

  am: {
    memory-mb: 128
    vcores: 1
  }

  # Configuration for each Drillbit. Drill requires that all Drillbits use the
  # same configuration.

  drillbit: {

    # The amount of memory to allocate to each Drill-bit. This is the amount of memory requested
    # from YARN for each drill-bit. This must be sufficient for
    # the amount of heap memory allocated in drill-env.sh, and the off-heap memory
    # allocated in drill-override.conf.

    memory-mb: 1024

    # The number of YARN virtual cores to allocate to each drill-bit.

    vcores: 4
    
    # The amount of heap memory to allocate to Drill. This is the equivalent of the
    # DRILL_HEAP environment variable in drill-env.sh when launching Drill outside
    # of YARN.
    
    heap: "4G"
    
    # The maximum amount of direct memory to allocate to Drill. This is the equivalent of the
    # DRILL_MAX_DIRECT_MEMORY environment variable in drill-env.sh when launching Drill outside
    # of YARN.
    
    max-direct-memory: "8G"
    
    # Additional JVM arguments for the Drillbit. Corresponds to your custom entries
    # to DRILL_JAVA_OPTS set in drill-env.sh. Do not repeat the standard options here.
    
    vm-args: ""
    
    # Add to the class path. Use for things such as HBase, etc. which must be installed
    # on every node. (Drill automatically adds its own class path as well as the one
    # provided by YARN.)
    
    classpath: ""

    # Set this if you use other than the default Drillbit HTTP port.

    http-port: 4047
  }

  # The pools of hosts on which to launch Drill. Each pool can be one of several types.
  #
  # Note: This version supports a single pool. The example below has multiple pools
  # only to illustrate the various pool types.

  pools: [
    {
      # Arbitrary name, just used for error and statistics reporting.
      # Defaults to "pool-" pool index, starting at 1.

      name: "pool1"

      # Basic pool: let YARN pick any available node.

      type: "basic"

      # Number of Drill-bits to run. (Drill-on-YARN runs each on a separate host,
      # so this is also the number of hosts that will run Drill.)

      count: 2
    },
    {
      name: "pool2"

      # Labeled pool: Use YARN labels to identify which nodes should run Drill.

      type: "labeled"

      # The YARN label expression to use to select nodes.

      label: "drill"

      # The number of Drill-bits (hosts) to request.

      count: 2
    }
  ]
}